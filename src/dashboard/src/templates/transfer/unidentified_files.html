{% extends "layout_fluid.html" %}
{% load breadcrumb %}

{% block extra_css %}
  <link href="{{ STATIC_URL }}vendor/datatables/css/jquery.dataTables.css" rel="stylesheet">
{% endblock %}

{% block js %}
<script type="text/javascript" src="{{ STATIC_URL }}vendor/datatables/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}vendor/readmore.min.js"></script>

<script type="text/javascript">
  $(document).ready(function()
  {
    function render_stderror_col(stderror, type, row_data) {
      return '<pre class="stderror-col">' + stderror + '</pre>';
    }

    var cols = [
      {sTitle: 'Filename', mData: 'filename'},
      {sTitle: 'STDERR', mData: 'stderror', mRender: render_stderror_col},
      {sTitle: 'Enter PUID manually', mData: null},
      {sTitle: 'Submit to PRONOM', mData: null}
    ];

    var dtable = $('#files-table').dataTable({
      'bLengthChange': false,
      'bFilter': false,
      'bAutoWidth': true,
      'sPaginationType': 'full_numbers',
      'bServerSide': true,
      'sAjaxSource': '/transfer/get_unidentified_files/{{ uuid }}',
      'aoColumns': cols,
      'iDisplayLength': 5,
      'fnServerData': function(sSource, aoData, fnCallback) {
        $.getJSON(sSource, aoData, function(json) {
          fnCallback(json);

          $('.stderror-col').readmore({
            collapsedHeight: 45
          });
        });
      },
    });
  });
</script>
{% endblock %}

{% block content %}
    Total files in transfer: {{ total_file_count }} <br>
    Total unidentified files: {{ unidentified_file_count }}
    <table id="files-table">
    </table>

    <br>
    Re-identify selected files with:
    <select>
      {% for item in tool_choices %}
        <option value="{{ item.0 }}">{{ item.1 }}</option>
      {% endfor %}
    </select>
{% endblock %}
